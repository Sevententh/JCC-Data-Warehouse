CREATE VIEW AA_ED_CST_TRANS_VIEW
AS
select 
CT_TRANTYPE,
CT_STATUS,
CT_POSTTYPE,
CT_BATCH_FLAG,
CASE WHEN CT_STATUS='E' THEN CT_QUANTITY ELSE 0 END AS EST_QTY,
CASE WHEN CT_STATUS='A' THEN CT_QUANTITY ELSE 0 END AS ACT_QTY,
CASE WHEN CT_STATUS='E' AND CT_POSTTYPE='C' THEN CT_NETT ELSE 0 END AS EST_COST_NET,
CASE WHEN CT_STATUS='A' AND CT_POSTTYPE='C' THEN CT_NETT ELSE 0 END AS ACT_COST_NET,
CASE WHEN CT_STATUS='E' AND CT_POSTTYPE='C' THEN CT_VAT ELSE 0 END AS EST_COST_VAT,
CASE WHEN CT_STATUS='A' AND CT_POSTTYPE='C' THEN CT_VAT ELSE 0 END AS ACT_COST_VAT,
CASE WHEN CT_STATUS='E' AND CT_POSTTYPE='C' THEN CT_GROSS ELSE 0 END AS EST_COST_GROSS,
CASE WHEN CT_STATUS='A' AND CT_POSTTYPE='C' THEN CT_GROSS ELSE 0 END AS ACT_COST_GROSS,
CASE WHEN CT_STATUS='E' AND CT_POSTTYPE='S' THEN CT_NETT ELSE 0 END AS EST_SALE_NET,
CASE WHEN CT_STATUS='A' AND CT_POSTTYPE='S' THEN CT_NETT ELSE 0 END AS ACT_SALE_NET,
CASE WHEN CT_STATUS='E' AND CT_POSTTYPE='S' THEN CT_VAT ELSE 0 END AS EST_SALE_VAT,
CASE WHEN CT_STATUS='A' AND CT_POSTTYPE='S' THEN CT_VAT ELSE 0 END AS ACT_SALE_VAT,
CASE WHEN CT_STATUS='E' AND CT_POSTTYPE='S' THEN CT_GROSS ELSE 0 END AS EST_SALE_GROSS,
CASE WHEN CT_STATUS='A' AND CT_POSTTYPE='S' THEN CT_GROSS ELSE 0 END AS ACT_SALE_GROSS,
CT_HEADER_REF,
CT_DATE,
CT_PUTIN_LEDGER,
CT_UPDATE_USER1,
CT_UPDATE_USER2,
CT_PRICE,
CT_PERIODNUMBR,
CT_YEAR,
CT_WEEK_NO,
CT_COSTCENTRE,
CH_NAME,
CH_SORT,
CH_USER1,
CH_USER2,
CH_USER3,
CH_USER4,
CH_USER5,
CH_USER6,
CT_COSTHEADER,
CC_NAME,
CUNAME,
CT_RESOURCE,
PRNAME,
PR_SORT_KEY,
PR_SORT_KEY1,
PR_SORT_KEY2,
PR_SORT_KEY3,
PR_SORT_KEY4,
PR_SORT_KEY5,
PR_SORT_KEY6,
CT_STOCKCODE,
STKNAME

FROM CST_DETAIL
JOIN AA_ED_COSTCENTRE_REC_VIEW ON CT_COSTHEADER=CH_CODE AND CT_COSTCENTRE=CC_CODE
LEFT JOIN PRC_PRICE_RECS ON CT_RESOURCE=PRCODE
LEFT JOIN STK_STOCK ON CT_STOCKCODE=STKCODE
