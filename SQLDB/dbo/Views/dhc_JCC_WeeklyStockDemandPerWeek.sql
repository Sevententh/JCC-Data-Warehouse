 
CREATE VIEW [dbo].[dhc_JCC_WeeklyStockDemandPerWeek]
AS
	SELECT	STKCODE as WeekDemandPWStockCode,isnull(sum(case when OD_DATE>=dbo.dhc_getWeekStartDate(getdate(),-65) and OD_DATE<dbo.dhc_getWeekStartDate(getdate(),-64) then (case OD_TYPE when 'O' then OD_QTYORD else -OD_QTYORD end) else 0 end),0) as Demand,65 as Week FROM STK_STOCK left outer join dhc_cons_ORD_DETAIL_grouped on OD_STOCK_CODE=STKCODE GROUP BY STKCODE UNION ALL
	SELECT	STKCODE as WeekDemandPWStockCode,isnull(sum(case when OD_DATE>=dbo.dhc_getWeekStartDate(getdate(),-64) and OD_DATE<dbo.dhc_getWeekStartDate(getdate(),-63) then (case OD_TYPE when 'O' then OD_QTYORD else -OD_QTYORD end) else 0 end),0) as Demand,64 as Week FROM STK_STOCK left outer join dhc_cons_ORD_DETAIL_grouped on OD_STOCK_CODE=STKCODE GROUP BY STKCODE UNION ALL
	SELECT	STKCODE as WeekDemandPWStockCode,isnull(sum(case when OD_DATE>=dbo.dhc_getWeekStartDate(getdate(),-63) and OD_DATE<dbo.dhc_getWeekStartDate(getdate(),-62) then (case OD_TYPE when 'O' then OD_QTYORD else -OD_QTYORD end) else 0 end),0) as Demand,63 as Week FROM STK_STOCK left outer join dhc_cons_ORD_DETAIL_grouped on OD_STOCK_CODE=STKCODE GROUP BY STKCODE UNION ALL
	SELECT	STKCODE as WeekDemandPWStockCode,isnull(sum(case when OD_DATE>=dbo.dhc_getWeekStartDate(getdate(),-62) and OD_DATE<dbo.dhc_getWeekStartDate(getdate(),-61) then (case OD_TYPE when 'O' then OD_QTYORD else -OD_QTYORD end) else 0 end),0) as Demand,62 as Week FROM STK_STOCK left outer join dhc_cons_ORD_DETAIL_grouped on OD_STOCK_CODE=STKCODE GROUP BY STKCODE UNION ALL
	SELECT	STKCODE as WeekDemandPWStockCode,isnull(sum(case when OD_DATE>=dbo.dhc_getWeekStartDate(getdate(),-61) and OD_DATE<dbo.dhc_getWeekStartDate(getdate(),-60) then (case OD_TYPE when 'O' then OD_QTYORD else -OD_QTYORD end) else 0 end),0) as Demand,61 as Week FROM STK_STOCK left outer join dhc_cons_ORD_DETAIL_grouped on OD_STOCK_CODE=STKCODE GROUP BY STKCODE UNION ALL
	SELECT	STKCODE as WeekDemandPWStockCode,isnull(sum(case when OD_DATE>=dbo.dhc_getWeekStartDate(getdate(),-60) and OD_DATE<dbo.dhc_getWeekStartDate(getdate(),-59) then (case OD_TYPE when 'O' then OD_QTYORD else -OD_QTYORD end) else 0 end),0) as Demand,60 as Week FROM STK_STOCK left outer join dhc_cons_ORD_DETAIL_grouped on OD_STOCK_CODE=STKCODE GROUP BY STKCODE UNION ALL
	SELECT	STKCODE as WeekDemandPWStockCode,isnull(sum(case when OD_DATE>=dbo.dhc_getWeekStartDate(getdate(),-59) and OD_DATE<dbo.dhc_getWeekStartDate(getdate(),-58) then (case OD_TYPE when 'O' then OD_QTYORD else -OD_QTYORD end) else 0 end),0) as Demand,59 as Week FROM STK_STOCK left outer join dhc_cons_ORD_DETAIL_grouped on OD_STOCK_CODE=STKCODE GROUP BY STKCODE UNION ALL
	SELECT	STKCODE as WeekDemandPWStockCode,isnull(sum(case when OD_DATE>=dbo.dhc_getWeekStartDate(getdate(),-58) and OD_DATE<dbo.dhc_getWeekStartDate(getdate(),-57) then (case OD_TYPE when 'O' then OD_QTYORD else -OD_QTYORD end) else 0 end),0) as Demand,58 as Week FROM STK_STOCK left outer join dhc_cons_ORD_DETAIL_grouped on OD_STOCK_CODE=STKCODE GROUP BY STKCODE UNION ALL
	SELECT	STKCODE as WeekDemandPWStockCode,isnull(sum(case when OD_DATE>=dbo.dhc_getWeekStartDate(getdate(),-57) and OD_DATE<dbo.dhc_getWeekStartDate(getdate(),-56) then (case OD_TYPE when 'O' then OD_QTYORD else -OD_QTYORD end) else 0 end),0) as Demand,57 as Week FROM STK_STOCK left outer join dhc_cons_ORD_DETAIL_grouped on OD_STOCK_CODE=STKCODE GROUP BY STKCODE UNION ALL
	SELECT	STKCODE as WeekDemandPWStockCode,isnull(sum(case when OD_DATE>=dbo.dhc_getWeekStartDate(getdate(),-56) and OD_DATE<dbo.dhc_getWeekStartDate(getdate(),-55) then (case OD_TYPE when 'O' then OD_QTYORD else -OD_QTYORD end) else 0 end),0) as Demand,56 as Week FROM STK_STOCK left outer join dhc_cons_ORD_DETAIL_grouped on OD_STOCK_CODE=STKCODE GROUP BY STKCODE UNION ALL
	SELECT	STKCODE as WeekDemandPWStockCode,isnull(sum(case when OD_DATE>=dbo.dhc_getWeekStartDate(getdate(),-55) and OD_DATE<dbo.dhc_getWeekStartDate(getdate(),-54) then (case OD_TYPE when 'O' then OD_QTYORD else -OD_QTYORD end) else 0 end),0) as Demand,55 as Week FROM STK_STOCK left outer join dhc_cons_ORD_DETAIL_grouped on OD_STOCK_CODE=STKCODE GROUP BY STKCODE UNION ALL
	SELECT	STKCODE as WeekDemandPWStockCode,isnull(sum(case when OD_DATE>=dbo.dhc_getWeekStartDate(getdate(),-54) and OD_DATE<dbo.dhc_getWeekStartDate(getdate(),-53) then (case OD_TYPE when 'O' then OD_QTYORD else -OD_QTYORD end) else 0 end),0) as Demand,54 as Week FROM STK_STOCK left outer join dhc_cons_ORD_DETAIL_grouped on OD_STOCK_CODE=STKCODE GROUP BY STKCODE UNION ALL

	SELECT	STKCODE as WeekDemandPWStockCode,isnull(sum(case when OD_DATE>=dbo.dhc_getWeekStartDate(getdate(),-53) and OD_DATE<dbo.dhc_getWeekStartDate(getdate(),-52) then (case OD_TYPE when 'O' then OD_QTYORD else -OD_QTYORD end) else 0 end),0) as Demand,53 as Week FROM STK_STOCK left outer join dhc_cons_ORD_DETAIL_grouped on OD_STOCK_CODE=STKCODE GROUP BY STKCODE UNION ALL
	SELECT	STKCODE as WeekDemandPWStockCode,isnull(sum(case when OD_DATE>=dbo.dhc_getWeekStartDate(getdate(),-52) and OD_DATE<dbo.dhc_getWeekStartDate(getdate(),-51) then (case OD_TYPE when 'O' then OD_QTYORD else -OD_QTYORD end) else 0 end),0) as Demand,52 as Week FROM STK_STOCK left outer join dhc_cons_ORD_DETAIL_grouped on OD_STOCK_CODE=STKCODE GROUP BY STKCODE UNION ALL
	SELECT	STKCODE as WeekDemandPWStockCode,isnull(sum(case when OD_DATE>=dbo.dhc_getWeekStartDate(getdate(),-51) and OD_DATE<dbo.dhc_getWeekStartDate(getdate(),-50) then (case OD_TYPE when 'O' then OD_QTYORD else -OD_QTYORD end) else 0 end),0) as Demand,51 as Week FROM STK_STOCK left outer join dhc_cons_ORD_DETAIL_grouped on OD_STOCK_CODE=STKCODE GROUP BY STKCODE UNION ALL
	SELECT	STKCODE as WeekDemandPWStockCode,isnull(sum(case when OD_DATE>=dbo.dhc_getWeekStartDate(getdate(),-50) and OD_DATE<dbo.dhc_getWeekStartDate(getdate(),-49) then (case OD_TYPE when 'O' then OD_QTYORD else -OD_QTYORD end) else 0 end),0) as Demand,50 as Week FROM STK_STOCK left outer join dhc_cons_ORD_DETAIL_grouped on OD_STOCK_CODE=STKCODE GROUP BY STKCODE UNION ALL
	SELECT	STKCODE as WeekDemandPWStockCode,isnull(sum(case when OD_DATE>=dbo.dhc_getWeekStartDate(getdate(),-49) and OD_DATE<dbo.dhc_getWeekStartDate(getdate(),-48) then (case OD_TYPE when 'O' then OD_QTYORD else -OD_QTYORD end) else 0 end),0) as Demand,49 as Week FROM STK_STOCK left outer join dhc_cons_ORD_DETAIL_grouped on OD_STOCK_CODE=STKCODE GROUP BY STKCODE UNION ALL
	SELECT	STKCODE as WeekDemandPWStockCode,isnull(sum(case when OD_DATE>=dbo.dhc_getWeekStartDate(getdate(),-48) and OD_DATE<dbo.dhc_getWeekStartDate(getdate(),-47) then (case OD_TYPE when 'O' then OD_QTYORD else -OD_QTYORD end) else 0 end),0) as Demand,48 as Week FROM STK_STOCK left outer join dhc_cons_ORD_DETAIL_grouped on OD_STOCK_CODE=STKCODE GROUP BY STKCODE UNION ALL
	SELECT	STKCODE as WeekDemandPWStockCode,isnull(sum(case when OD_DATE>=dbo.dhc_getWeekStartDate(getdate(),-47) and OD_DATE<dbo.dhc_getWeekStartDate(getdate(),-46) then (case OD_TYPE when 'O' then OD_QTYORD else -OD_QTYORD end) else 0 end),0) as Demand,47 as Week FROM STK_STOCK left outer join dhc_cons_ORD_DETAIL_grouped on OD_STOCK_CODE=STKCODE GROUP BY STKCODE UNION ALL
	SELECT	STKCODE as WeekDemandPWStockCode,isnull(sum(case when OD_DATE>=dbo.dhc_getWeekStartDate(getdate(),-46) and OD_DATE<dbo.dhc_getWeekStartDate(getdate(),-45) then (case OD_TYPE when 'O' then OD_QTYORD else -OD_QTYORD end) else 0 end),0) as Demand,46 as Week FROM STK_STOCK left outer join dhc_cons_ORD_DETAIL_grouped on OD_STOCK_CODE=STKCODE GROUP BY STKCODE UNION ALL
	SELECT	STKCODE as WeekDemandPWStockCode,isnull(sum(case when OD_DATE>=dbo.dhc_getWeekStartDate(getdate(),-45) and OD_DATE<dbo.dhc_getWeekStartDate(getdate(),-44) then (case OD_TYPE when 'O' then OD_QTYORD else -OD_QTYORD end) else 0 end),0) as Demand,45 as Week FROM STK_STOCK left outer join dhc_cons_ORD_DETAIL_grouped on OD_STOCK_CODE=STKCODE GROUP BY STKCODE UNION ALL
	SELECT	STKCODE as WeekDemandPWStockCode,isnull(sum(case when OD_DATE>=dbo.dhc_getWeekStartDate(getdate(),-44) and OD_DATE<dbo.dhc_getWeekStartDate(getdate(),-43) then (case OD_TYPE when 'O' then OD_QTYORD else -OD_QTYORD end) else 0 end),0) as Demand,44 as Week FROM STK_STOCK left outer join dhc_cons_ORD_DETAIL_grouped on OD_STOCK_CODE=STKCODE GROUP BY STKCODE UNION ALL
	SELECT	STKCODE as WeekDemandPWStockCode,isnull(sum(case when OD_DATE>=dbo.dhc_getWeekStartDate(getdate(),-43) and OD_DATE<dbo.dhc_getWeekStartDate(getdate(),-42) then (case OD_TYPE when 'O' then OD_QTYORD else -OD_QTYORD end) else 0 end),0) as Demand,43 as Week FROM STK_STOCK left outer join dhc_cons_ORD_DETAIL_grouped on OD_STOCK_CODE=STKCODE GROUP BY STKCODE UNION ALL
	SELECT	STKCODE as WeekDemandPWStockCode,isnull(sum(case when OD_DATE>=dbo.dhc_getWeekStartDate(getdate(),-42) and OD_DATE<dbo.dhc_getWeekStartDate(getdate(),-41) then (case OD_TYPE when 'O' then OD_QTYORD else -OD_QTYORD end) else 0 end),0) as Demand,42 as Week FROM STK_STOCK left outer join dhc_cons_ORD_DETAIL_grouped on OD_STOCK_CODE=STKCODE GROUP BY STKCODE UNION ALL
	SELECT	STKCODE as WeekDemandPWStockCode,isnull(sum(case when OD_DATE>=dbo.dhc_getWeekStartDate(getdate(),-41) and OD_DATE<dbo.dhc_getWeekStartDate(getdate(),-40) then (case OD_TYPE when 'O' then OD_QTYORD else -OD_QTYORD end) else 0 end),0) as Demand,41 as Week FROM STK_STOCK left outer join dhc_cons_ORD_DETAIL_grouped on OD_STOCK_CODE=STKCODE GROUP BY STKCODE UNION ALL
	SELECT	STKCODE as WeekDemandPWStockCode,isnull(sum(case when OD_DATE>=dbo.dhc_getWeekStartDate(getdate(),-40) and OD_DATE<dbo.dhc_getWeekStartDate(getdate(),-39) then (case OD_TYPE when 'O' then OD_QTYORD else -OD_QTYORD end) else 0 end),0) as Demand,40 as Week FROM STK_STOCK left outer join dhc_cons_ORD_DETAIL_grouped on OD_STOCK_CODE=STKCODE GROUP BY STKCODE UNION ALL
	SELECT	STKCODE as WeekDemandPWStockCode,isnull(sum(case when OD_DATE>=dbo.dhc_getWeekStartDate(getdate(),-39) and OD_DATE<dbo.dhc_getWeekStartDate(getdate(),-38) then (case OD_TYPE when 'O' then OD_QTYORD else -OD_QTYORD end) else 0 end),0) as Demand,39 as Week FROM STK_STOCK left outer join dhc_cons_ORD_DETAIL_grouped on OD_STOCK_CODE=STKCODE GROUP BY STKCODE UNION ALL
	SELECT	STKCODE as WeekDemandPWStockCode,isnull(sum(case when OD_DATE>=dbo.dhc_getWeekStartDate(getdate(),-38) and OD_DATE<dbo.dhc_getWeekStartDate(getdate(),-37) then (case OD_TYPE when 'O' then OD_QTYORD else -OD_QTYORD end) else 0 end),0) as Demand,38 as Week FROM STK_STOCK left outer join dhc_cons_ORD_DETAIL_grouped on OD_STOCK_CODE=STKCODE GROUP BY STKCODE UNION ALL
	SELECT	STKCODE as WeekDemandPWStockCode,isnull(sum(case when OD_DATE>=dbo.dhc_getWeekStartDate(getdate(),-37) and OD_DATE<dbo.dhc_getWeekStartDate(getdate(),-36) then (case OD_TYPE when 'O' then OD_QTYORD else -OD_QTYORD end) else 0 end),0) as Demand,37 as Week FROM STK_STOCK left outer join dhc_cons_ORD_DETAIL_grouped on OD_STOCK_CODE=STKCODE GROUP BY STKCODE UNION ALL
	SELECT	STKCODE as WeekDemandPWStockCode,isnull(sum(case when OD_DATE>=dbo.dhc_getWeekStartDate(getdate(),-36) and OD_DATE<dbo.dhc_getWeekStartDate(getdate(),-35) then (case OD_TYPE when 'O' then OD_QTYORD else -OD_QTYORD end) else 0 end),0) as Demand,36 as Week FROM STK_STOCK left outer join dhc_cons_ORD_DETAIL_grouped on OD_STOCK_CODE=STKCODE GROUP BY STKCODE UNION ALL
	SELECT	STKCODE as WeekDemandPWStockCode,isnull(sum(case when OD_DATE>=dbo.dhc_getWeekStartDate(getdate(),-35) and OD_DATE<dbo.dhc_getWeekStartDate(getdate(),-34) then (case OD_TYPE when 'O' then OD_QTYORD else -OD_QTYORD end) else 0 end),0) as Demand,35 as Week FROM STK_STOCK left outer join dhc_cons_ORD_DETAIL_grouped on OD_STOCK_CODE=STKCODE GROUP BY STKCODE UNION ALL
	SELECT	STKCODE as WeekDemandPWStockCode,isnull(sum(case when OD_DATE>=dbo.dhc_getWeekStartDate(getdate(),-34) and OD_DATE<dbo.dhc_getWeekStartDate(getdate(),-33) then (case OD_TYPE when 'O' then OD_QTYORD else -OD_QTYORD end) else 0 end),0) as Demand,34 as Week FROM STK_STOCK left outer join dhc_cons_ORD_DETAIL_grouped on OD_STOCK_CODE=STKCODE GROUP BY STKCODE UNION ALL
	SELECT	STKCODE as WeekDemandPWStockCode,isnull(sum(case when OD_DATE>=dbo.dhc_getWeekStartDate(getdate(),-33) and OD_DATE<dbo.dhc_getWeekStartDate(getdate(),-32) then (case OD_TYPE when 'O' then OD_QTYORD else -OD_QTYORD end) else 0 end),0) as Demand,33 as Week FROM STK_STOCK left outer join dhc_cons_ORD_DETAIL_grouped on OD_STOCK_CODE=STKCODE GROUP BY STKCODE UNION ALL
	SELECT	STKCODE as WeekDemandPWStockCode,isnull(sum(case when OD_DATE>=dbo.dhc_getWeekStartDate(getdate(),-32) and OD_DATE<dbo.dhc_getWeekStartDate(getdate(),-31) then (case OD_TYPE when 'O' then OD_QTYORD else -OD_QTYORD end) else 0 end),0) as Demand,32 as Week FROM STK_STOCK left outer join dhc_cons_ORD_DETAIL_grouped on OD_STOCK_CODE=STKCODE GROUP BY STKCODE UNION ALL
	SELECT	STKCODE as WeekDemandPWStockCode,isnull(sum(case when OD_DATE>=dbo.dhc_getWeekStartDate(getdate(),-31) and OD_DATE<dbo.dhc_getWeekStartDate(getdate(),-30) then (case OD_TYPE when 'O' then OD_QTYORD else -OD_QTYORD end) else 0 end),0) as Demand,31 as Week FROM STK_STOCK left outer join dhc_cons_ORD_DETAIL_grouped on OD_STOCK_CODE=STKCODE GROUP BY STKCODE UNION ALL
	SELECT	STKCODE as WeekDemandPWStockCode,isnull(sum(case when OD_DATE>=dbo.dhc_getWeekStartDate(getdate(),-30) and OD_DATE<dbo.dhc_getWeekStartDate(getdate(),-29) then (case OD_TYPE when 'O' then OD_QTYORD else -OD_QTYORD end) else 0 end),0) as Demand,30 as Week FROM STK_STOCK left outer join dhc_cons_ORD_DETAIL_grouped on OD_STOCK_CODE=STKCODE GROUP BY STKCODE UNION ALL
	SELECT	STKCODE as WeekDemandPWStockCode,isnull(sum(case when OD_DATE>=dbo.dhc_getWeekStartDate(getdate(),-29) and OD_DATE<dbo.dhc_getWeekStartDate(getdate(),-28) then (case OD_TYPE when 'O' then OD_QTYORD else -OD_QTYORD end) else 0 end),0) as Demand,29 as Week FROM STK_STOCK left outer join dhc_cons_ORD_DETAIL_grouped on OD_STOCK_CODE=STKCODE GROUP BY STKCODE UNION ALL
	SELECT	STKCODE as WeekDemandPWStockCode,isnull(sum(case when OD_DATE>=dbo.dhc_getWeekStartDate(getdate(),-28) and OD_DATE<dbo.dhc_getWeekStartDate(getdate(),-27) then (case OD_TYPE when 'O' then OD_QTYORD else -OD_QTYORD end) else 0 end),0) as Demand,28 as Week FROM STK_STOCK left outer join dhc_cons_ORD_DETAIL_grouped on OD_STOCK_CODE=STKCODE GROUP BY STKCODE UNION ALL
	SELECT	STKCODE as WeekDemandPWStockCode,isnull(sum(case when OD_DATE>=dbo.dhc_getWeekStartDate(getdate(),-27) and OD_DATE<dbo.dhc_getWeekStartDate(getdate(),-26) then (case OD_TYPE when 'O' then OD_QTYORD else -OD_QTYORD end) else 0 end),0) as Demand,27 as Week FROM STK_STOCK left outer join dhc_cons_ORD_DETAIL_grouped on OD_STOCK_CODE=STKCODE GROUP BY STKCODE UNION ALL
	SELECT	STKCODE as WeekDemandPWStockCode,isnull(sum(case when OD_DATE>=dbo.dhc_getWeekStartDate(getdate(),-26) and OD_DATE<dbo.dhc_getWeekStartDate(getdate(),-25) then (case OD_TYPE when 'O' then OD_QTYORD else -OD_QTYORD end) else 0 end),0) as Demand,26 as Week FROM STK_STOCK left outer join dhc_cons_ORD_DETAIL_grouped on OD_STOCK_CODE=STKCODE GROUP BY STKCODE UNION ALL
	SELECT	STKCODE as WeekDemandPWStockCode,isnull(sum(case when OD_DATE>=dbo.dhc_getWeekStartDate(getdate(),-25) and OD_DATE<dbo.dhc_getWeekStartDate(getdate(),-24) then (case OD_TYPE when 'O' then OD_QTYORD else -OD_QTYORD end) else 0 end),0) as Demand,25 as Week FROM STK_STOCK left outer join dhc_cons_ORD_DETAIL_grouped on OD_STOCK_CODE=STKCODE GROUP BY STKCODE UNION ALL
	SELECT	STKCODE as WeekDemandPWStockCode,isnull(sum(case when OD_DATE>=dbo.dhc_getWeekStartDate(getdate(),-24) and OD_DATE<dbo.dhc_getWeekStartDate(getdate(),-23) then (case OD_TYPE when 'O' then OD_QTYORD else -OD_QTYORD end) else 0 end),0) as Demand,24 as Week FROM STK_STOCK left outer join dhc_cons_ORD_DETAIL_grouped on OD_STOCK_CODE=STKCODE GROUP BY STKCODE UNION ALL
	SELECT	STKCODE as WeekDemandPWStockCode,isnull(sum(case when OD_DATE>=dbo.dhc_getWeekStartDate(getdate(),-23) and OD_DATE<dbo.dhc_getWeekStartDate(getdate(),-22) then (case OD_TYPE when 'O' then OD_QTYORD else -OD_QTYORD end) else 0 end),0) as Demand,23 as Week FROM STK_STOCK left outer join dhc_cons_ORD_DETAIL_grouped on OD_STOCK_CODE=STKCODE GROUP BY STKCODE UNION ALL
	SELECT	STKCODE as WeekDemandPWStockCode,isnull(sum(case when OD_DATE>=dbo.dhc_getWeekStartDate(getdate(),-22) and OD_DATE<dbo.dhc_getWeekStartDate(getdate(),-21) then (case OD_TYPE when 'O' then OD_QTYORD else -OD_QTYORD end) else 0 end),0) as Demand,22 as Week FROM STK_STOCK left outer join dhc_cons_ORD_DETAIL_grouped on OD_STOCK_CODE=STKCODE GROUP BY STKCODE UNION ALL
	SELECT	STKCODE as WeekDemandPWStockCode,isnull(sum(case when OD_DATE>=dbo.dhc_getWeekStartDate(getdate(),-21) and OD_DATE<dbo.dhc_getWeekStartDate(getdate(),-20) then (case OD_TYPE when 'O' then OD_QTYORD else -OD_QTYORD end) else 0 end),0) as Demand,21 as Week FROM STK_STOCK left outer join dhc_cons_ORD_DETAIL_grouped on OD_STOCK_CODE=STKCODE GROUP BY STKCODE UNION ALL
	SELECT	STKCODE as WeekDemandPWStockCode,isnull(sum(case when OD_DATE>=dbo.dhc_getWeekStartDate(getdate(),-20) and OD_DATE<dbo.dhc_getWeekStartDate(getdate(),-19) then (case OD_TYPE when 'O' then OD_QTYORD else -OD_QTYORD end) else 0 end),0) as Demand,20 as Week FROM STK_STOCK left outer join dhc_cons_ORD_DETAIL_grouped on OD_STOCK_CODE=STKCODE GROUP BY STKCODE UNION ALL
	SELECT	STKCODE as WeekDemandPWStockCode,isnull(sum(case when OD_DATE>=dbo.dhc_getWeekStartDate(getdate(),-19) and OD_DATE<dbo.dhc_getWeekStartDate(getdate(),-18) then (case OD_TYPE when 'O' then OD_QTYORD else -OD_QTYORD end) else 0 end),0) as Demand,19 as Week FROM STK_STOCK left outer join dhc_cons_ORD_DETAIL_grouped on OD_STOCK_CODE=STKCODE GROUP BY STKCODE UNION ALL
	SELECT	STKCODE as WeekDemandPWStockCode,isnull(sum(case when OD_DATE>=dbo.dhc_getWeekStartDate(getdate(),-18) and OD_DATE<dbo.dhc_getWeekStartDate(getdate(),-17) then (case OD_TYPE when 'O' then OD_QTYORD else -OD_QTYORD end) else 0 end),0) as Demand,18 as Week FROM STK_STOCK left outer join dhc_cons_ORD_DETAIL_grouped on OD_STOCK_CODE=STKCODE GROUP BY STKCODE UNION ALL
	SELECT	STKCODE as WeekDemandPWStockCode,isnull(sum(case when OD_DATE>=dbo.dhc_getWeekStartDate(getdate(),-17) and OD_DATE<dbo.dhc_getWeekStartDate(getdate(),-16) then (case OD_TYPE when 'O' then OD_QTYORD else -OD_QTYORD end) else 0 end),0) as Demand,17 as Week FROM STK_STOCK left outer join dhc_cons_ORD_DETAIL_grouped on OD_STOCK_CODE=STKCODE GROUP BY STKCODE UNION ALL
	SELECT	STKCODE as WeekDemandPWStockCode,isnull(sum(case when OD_DATE>=dbo.dhc_getWeekStartDate(getdate(),-16) and OD_DATE<dbo.dhc_getWeekStartDate(getdate(),-15) then (case OD_TYPE when 'O' then OD_QTYORD else -OD_QTYORD end) else 0 end),0) as Demand,16 as Week FROM STK_STOCK left outer join dhc_cons_ORD_DETAIL_grouped on OD_STOCK_CODE=STKCODE GROUP BY STKCODE UNION ALL
	SELECT	STKCODE as WeekDemandPWStockCode,isnull(sum(case when OD_DATE>=dbo.dhc_getWeekStartDate(getdate(),-15) and OD_DATE<dbo.dhc_getWeekStartDate(getdate(),-14) then (case OD_TYPE when 'O' then OD_QTYORD else -OD_QTYORD end) else 0 end),0) as Demand,15 as Week FROM STK_STOCK left outer join dhc_cons_ORD_DETAIL_grouped on OD_STOCK_CODE=STKCODE GROUP BY STKCODE UNION ALL
	SELECT	STKCODE as WeekDemandPWStockCode,isnull(sum(case when OD_DATE>=dbo.dhc_getWeekStartDate(getdate(),-14) and OD_DATE<dbo.dhc_getWeekStartDate(getdate(),-13) then (case OD_TYPE when 'O' then OD_QTYORD else -OD_QTYORD end) else 0 end),0) as Demand,14 as Week FROM STK_STOCK left outer join dhc_cons_ORD_DETAIL_grouped on OD_STOCK_CODE=STKCODE GROUP BY STKCODE UNION ALL
	SELECT	STKCODE as WeekDemandPWStockCode,isnull(sum(case when OD_DATE>=dbo.dhc_getWeekStartDate(getdate(),-13) and OD_DATE<dbo.dhc_getWeekStartDate(getdate(),-12) then (case OD_TYPE when 'O' then OD_QTYORD else -OD_QTYORD end) else 0 end),0) as Demand,13 as Week FROM STK_STOCK left outer join dhc_cons_ORD_DETAIL_grouped on OD_STOCK_CODE=STKCODE GROUP BY STKCODE UNION ALL
	SELECT	STKCODE as WeekDemandPWStockCode,isnull(sum(case when OD_DATE>=dbo.dhc_getWeekStartDate(getdate(),-12) and OD_DATE<dbo.dhc_getWeekStartDate(getdate(),-11) then (case OD_TYPE when 'O' then OD_QTYORD else -OD_QTYORD end) else 0 end),0) as Demand,12 as Week FROM STK_STOCK left outer join dhc_cons_ORD_DETAIL_grouped on OD_STOCK_CODE=STKCODE GROUP BY STKCODE UNION ALL
	SELECT	STKCODE as WeekDemandPWStockCode,isnull(sum(case when OD_DATE>=dbo.dhc_getWeekStartDate(getdate(),-11) and OD_DATE<dbo.dhc_getWeekStartDate(getdate(),-10) then (case OD_TYPE when 'O' then OD_QTYORD else -OD_QTYORD end) else 0 end),0) as Demand,11 as Week FROM STK_STOCK left outer join dhc_cons_ORD_DETAIL_grouped on OD_STOCK_CODE=STKCODE GROUP BY STKCODE UNION ALL
	SELECT	STKCODE as WeekDemandPWStockCode,isnull(sum(case when OD_DATE>=dbo.dhc_getWeekStartDate(getdate(),-10) and OD_DATE<dbo.dhc_getWeekStartDate(getdate(),-9) then (case OD_TYPE when 'O' then OD_QTYORD else -OD_QTYORD end) else 0 end),0) as Demand,10 as Week FROM STK_STOCK left outer join dhc_cons_ORD_DETAIL_grouped on OD_STOCK_CODE=STKCODE GROUP BY STKCODE UNION ALL
	SELECT	STKCODE as WeekDemandPWStockCode,isnull(sum(case when OD_DATE>=dbo.dhc_getWeekStartDate(getdate(),-9) and OD_DATE<dbo.dhc_getWeekStartDate(getdate(),-8) then (case OD_TYPE when 'O' then OD_QTYORD else -OD_QTYORD end) else 0 end),0) as Demand,9 as Week FROM STK_STOCK left outer join dhc_cons_ORD_DETAIL_grouped on OD_STOCK_CODE=STKCODE GROUP BY STKCODE UNION ALL
	SELECT	STKCODE as WeekDemandPWStockCode,isnull(sum(case when OD_DATE>=dbo.dhc_getWeekStartDate(getdate(),-8) and OD_DATE<dbo.dhc_getWeekStartDate(getdate(),-7) then (case OD_TYPE when 'O' then OD_QTYORD else -OD_QTYORD end) else 0 end),0) as Demand,8 as Week FROM STK_STOCK left outer join dhc_cons_ORD_DETAIL_grouped on OD_STOCK_CODE=STKCODE GROUP BY STKCODE UNION ALL
	SELECT	STKCODE as WeekDemandPWStockCode,isnull(sum(case when OD_DATE>=dbo.dhc_getWeekStartDate(getdate(),-7) and OD_DATE<dbo.dhc_getWeekStartDate(getdate(),-6) then (case OD_TYPE when 'O' then OD_QTYORD else -OD_QTYORD end) else 0 end),0) as Demand,7 as Week FROM STK_STOCK left outer join dhc_cons_ORD_DETAIL_grouped on OD_STOCK_CODE=STKCODE GROUP BY STKCODE UNION ALL
	SELECT	STKCODE as WeekDemandPWStockCode,isnull(sum(case when OD_DATE>=dbo.dhc_getWeekStartDate(getdate(),-6) and OD_DATE<dbo.dhc_getWeekStartDate(getdate(),-5) then (case OD_TYPE when 'O' then OD_QTYORD else -OD_QTYORD end) else 0 end),0) as Demand,6 as Week FROM STK_STOCK left outer join dhc_cons_ORD_DETAIL_grouped on OD_STOCK_CODE=STKCODE GROUP BY STKCODE UNION ALL
	SELECT	STKCODE as WeekDemandPWStockCode,isnull(sum(case when OD_DATE>=dbo.dhc_getWeekStartDate(getdate(),-5) and OD_DATE<dbo.dhc_getWeekStartDate(getdate(),-4) then (case OD_TYPE when 'O' then OD_QTYORD else -OD_QTYORD end) else 0 end),0) as Demand,5 as Week FROM STK_STOCK left outer join dhc_cons_ORD_DETAIL_grouped on OD_STOCK_CODE=STKCODE GROUP BY STKCODE UNION ALL
	SELECT	STKCODE as WeekDemandPWStockCode,isnull(sum(case when OD_DATE>=dbo.dhc_getWeekStartDate(getdate(),-4) and OD_DATE<dbo.dhc_getWeekStartDate(getdate(),-3) then (case OD_TYPE when 'O' then OD_QTYORD else -OD_QTYORD end) else 0 end),0) as Demand,4 as Week FROM STK_STOCK left outer join dhc_cons_ORD_DETAIL_grouped on OD_STOCK_CODE=STKCODE GROUP BY STKCODE UNION ALL
	SELECT	STKCODE as WeekDemandPWStockCode,isnull(sum(case when OD_DATE>=dbo.dhc_getWeekStartDate(getdate(),-3) and OD_DATE<dbo.dhc_getWeekStartDate(getdate(),-2) then (case OD_TYPE when 'O' then OD_QTYORD else -OD_QTYORD end) else 0 end),0) as Demand,3 as Week FROM STK_STOCK left outer join dhc_cons_ORD_DETAIL_grouped on OD_STOCK_CODE=STKCODE GROUP BY STKCODE UNION ALL
	SELECT	STKCODE as WeekDemandPWStockCode,isnull(sum(case when OD_DATE>=dbo.dhc_getWeekStartDate(getdate(),-2) and OD_DATE<dbo.dhc_getWeekStartDate(getdate(),-1) then (case OD_TYPE when 'O' then OD_QTYORD else -OD_QTYORD end) else 0 end),0) as Demand,2 as Week FROM STK_STOCK left outer join dhc_cons_ORD_DETAIL_grouped on OD_STOCK_CODE=STKCODE GROUP BY STKCODE UNION ALL
	SELECT	STKCODE as WeekDemandPWStockCode,isnull(sum(case when OD_DATE>=dbo.dhc_getWeekStartDate(getdate(),-1) and OD_DATE<dbo.dhc_getWeekStartDate(getdate(),0) then (case OD_TYPE when 'O' then OD_QTYORD else -OD_QTYORD end) else 0 end),0) as Demand,1 as Week FROM STK_STOCK left outer join dhc_cons_ORD_DETAIL_grouped on OD_STOCK_CODE=STKCODE GROUP BY STKCODE 

