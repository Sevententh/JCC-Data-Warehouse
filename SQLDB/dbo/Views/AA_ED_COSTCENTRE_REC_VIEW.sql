CREATE VIEW AA_ED_COSTCENTRE_REC_VIEW
AS
SELECT dbo.CST_COSTCENTRE.CC_CODE, dbo.CST_COSTCENTRE.CC_NAME, dbo.CST_COSTCENTRE.CC_STATUS, dbo.CST_COSTCENTRE.CC_ANALYSIS, 
                      dbo.CST_COSTCENTRE.CC_SORT, dbo.CST_COSTCENTRE.CC_USER_SUBTOT, dbo.CST_COSTCENTRE.CC_LEVEL, 
                      dbo.CST_COSTCENTRE.CC_LEVELPOINTER, dbo.CST_COSTCENTRE.CC_LEVELSEQ, dbo.CST_COSTCENTRE.CC_TIME_QTY_B, 
                      dbo.CST_COSTCENTRE.CC_TIME_QTY_A, dbo.CST_COSTCENTRE.CC_COST_INVTD, dbo.CST_COSTCENTRE.CC_COST_PAYTD, 
                      dbo.CST_COSTCENTRE.CC_COST_OBUDG1, dbo.CST_COSTCENTRE.CC_COST_RBUDG2, dbo.CST_COSTCENTRE.CC_ACTUAL_COST, 
                      dbo.CST_COSTCENTRE.CC_COMITT_COST, dbo.CST_COSTCENTRE.CC_USER_COST1, dbo.CST_COSTCENTRE.CC_USER_COST2, 
                      dbo.CST_COSTCENTRE.CC_ACTUAL_SALES, dbo.CST_COSTCENTRE.CC_SALE_OBUDG1, dbo.CST_COSTCENTRE.CC_SALE_RBUDG2, 
                      dbo.CST_COSTCENTRE.CC_COMITT_SALES, dbo.CST_COSTCENTRE.CC_USER_SALES1, dbo.CST_COSTCENTRE.CC_USER_SALES2, 
                      dbo.CST_COSTCENTRE.CC_SALE_PAYTD, dbo.CST_COSTCENTRE.CC_SALE_VAT, dbo.CST_COSTCENTRE.CC_SALE_INVTD, 
                      dbo.CST_COSTCENTRE.CC_DATE_REQ, dbo.CST_COSTCENTRE.CC_DURATION, dbo.CST_COSTCENTRE.CC_DUR_TYPE, 
                      dbo.CST_COSTCENTRE.CC_COST_O_1, dbo.CST_COSTCENTRE.CC_COST_O_2, dbo.CST_COSTCENTRE.CC_COST_O_3, 
                      dbo.CST_COSTCENTRE.CC_COST_O_4, dbo.CST_COSTCENTRE.CC_COST_O_5, dbo.CST_COSTCENTRE.CC_COST_O_6, 
                      dbo.CST_COSTCENTRE.CC_COST_O_7, dbo.CST_COSTCENTRE.CC_COST_O_8, dbo.CST_COSTCENTRE.CC_COST_O_9, 
                      dbo.CST_COSTCENTRE.CC_COST_O_10, dbo.CST_COSTCENTRE.CC_COST_O_11, dbo.CST_COSTCENTRE.CC_COST_O_12, 
                      dbo.CST_COSTCENTRE.CC_COST_O_13, dbo.CST_COSTCENTRE.CC_COST_L_1, dbo.CST_COSTCENTRE.CC_COST_L_2, 
                      dbo.CST_COSTCENTRE.CC_COST_L_3, dbo.CST_COSTCENTRE.CC_COST_L_4, dbo.CST_COSTCENTRE.CC_COST_L_5, 
                      dbo.CST_COSTCENTRE.CC_COST_L_6, dbo.CST_COSTCENTRE.CC_COST_L_7, dbo.CST_COSTCENTRE.CC_COST_L_8, 
                      dbo.CST_COSTCENTRE.CC_COST_L_9, dbo.CST_COSTCENTRE.CC_COST_L_10, dbo.CST_COSTCENTRE.CC_COST_L_11, 
                      dbo.CST_COSTCENTRE.CC_COST_L_12, dbo.CST_COSTCENTRE.CC_COST_L_13, dbo.CST_COSTCENTRE.CC_COST_C_1, 
                      dbo.CST_COSTCENTRE.CC_COST_C_2, dbo.CST_COSTCENTRE.CC_COST_C_3, dbo.CST_COSTCENTRE.CC_COST_C_4, 
                      dbo.CST_COSTCENTRE.CC_COST_C_5, dbo.CST_COSTCENTRE.CC_COST_C_6, dbo.CST_COSTCENTRE.CC_COST_C_7, 
                      dbo.CST_COSTCENTRE.CC_COST_C_8, dbo.CST_COSTCENTRE.CC_COST_C_9, dbo.CST_COSTCENTRE.CC_COST_C_10, 
                      dbo.CST_COSTCENTRE.CC_COST_C_11, dbo.CST_COSTCENTRE.CC_COST_C_12, dbo.CST_COSTCENTRE.CC_COST_C_13, 
                      dbo.AA_ED_PROJECT_RECS_VIEW.CH_CODE, dbo.AA_ED_PROJECT_RECS_VIEW.CH_NAME, dbo.AA_ED_PROJECT_RECS_VIEW.CH_STATUS, 
                      dbo.AA_ED_PROJECT_RECS_VIEW.CH_SORT, dbo.AA_ED_PROJECT_RECS_VIEW.CH_DATE_USER1, 
                      dbo.AA_ED_PROJECT_RECS_VIEW.CH_DATE_USER2, dbo.AA_ED_PROJECT_RECS_VIEW.CH_DATE_USER3, 
                      dbo.AA_ED_PROJECT_RECS_VIEW.CH_DATE_EST, dbo.AA_ED_PROJECT_RECS_VIEW.CH_DATE_REQ, 
                      dbo.AA_ED_PROJECT_RECS_VIEW.CH_DURATION, dbo.AA_ED_PROJECT_RECS_VIEW.CH_DUR_TYPE, 
                      dbo.AA_ED_PROJECT_RECS_VIEW.CH_USER1, dbo.AA_ED_PROJECT_RECS_VIEW.CH_USER2, dbo.AA_ED_PROJECT_RECS_VIEW.CH_USER3, 
                      dbo.AA_ED_PROJECT_RECS_VIEW.CH_USER4, dbo.AA_ED_PROJECT_RECS_VIEW.CH_USER5, dbo.AA_ED_PROJECT_RECS_VIEW.CH_USER6, 
                      dbo.AA_ED_PROJECT_RECS_VIEW.CH_ACCOUNT, dbo.AA_ED_PROJECT_RECS_VIEW.CUNAME, dbo.SL_ANALYSIS.SANAME,
	       CASE WHEN isnull(CC_COST_RBUDG2, 0) = 0 THEN CC_COST_OBUDG1 ELSE CC_COST_RBUDG2 END AS CURRENT_CBUDGET, 
	       CASE WHEN isnull(CC_SALE_RBUDG2, 0)  = 0 THEN CC_SALE_OBUDG1 ELSE CC_SALE_RBUDG2 END AS CURRENT_SBUDGET,
	       DATEDIFF(d,getdate(),CC_DATE_REQ) as SHORTFALL
FROM         dbo.CST_COSTCENTRE INNER JOIN
                      dbo.AA_ED_PROJECT_RECS_VIEW ON dbo.CST_COSTCENTRE.CC_COPYHEADER = dbo.AA_ED_PROJECT_RECS_VIEW.CH_CODE LEFT OUTER JOIN
                      dbo.SL_ANALYSIS ON dbo.CST_COSTCENTRE.CC_ANALYSIS = dbo.SL_ANALYSIS.SACODE