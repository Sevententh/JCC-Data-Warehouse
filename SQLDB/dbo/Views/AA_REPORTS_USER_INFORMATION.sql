create view AA_REPORTS_USER_INFORMATION
as
/*
** Written     :  9/3/2012 RL and CW
** Last Amended:  5/4/2012 RL, 20/4/2012 RL
** Comments    :  Returns User information, including security profile module access
**
*/
select 
USER_ID,
USER_NAME, 
DATE_IN, 
convert(varchar,TIME_IN,8) TIME_IN,
convert(varchar,TIME_OUT,8) TIME_OUT,
UP_CODE,
USER_MASTER,
USER_LANGUAGE,
USER_DOMAIN, 
USER_DMS_USERNAME,
USER_DMS_USERID,
USER_WFF_ADMINISTRATOR,
USER_LOCKED,
convert(varchar,UPG_LOGON_TIME_BEGIN,8) UPG_LOGON_TIME_BEGIN,
convert(varchar,UPG_LOGON_TIME_END,8) UPG_LOGON_TIME_END,
DefaultSOPStatus,
UPG_SOP_STATUS_LEVEL,
UPG_BATCH_ONLY,
UPG_NO_REPORTS,
UPG_SL_FUTURE_POST,
UPG_SL_C_YEAR_ONLY,
UPG_PL_FUTURE_POST,
UPG_PL_C_YEAR_ONLY,
UPG_NL_FUTURE_POST,
UPG_NL_C_YEAR_ONLY,
UPG_STK_FUTURE_POST,
UPG_STK_C_YEAR_ONLY,
UPG_SOP_FUTURE_POST,
UPG_SOP_C_YEAR_ONLY,
UPG_POP_FUTURE_POST,
UPG_POP_C_YEAR_ONLY,
UPG_CST_FUTURE_POST,
UPG_CST_C_YEAR_ONLY,
UPG_AUTHORISE_OWN,
UPG_AUTHORISE_ORDERS,
UPG_ORDER_BUDGET,
UPG_CURRENT_BUDGET,
UPG_PREVIOUS_BUDGET,
UPG_BUDGET_GROUP,
UPG_REVISE_USER_BUDGETS,
UPG_AUTHORISE_ALL,
UPG_CHECK_BUDGET_VALUES,
UPG_AUTHORISE_TYPE,
UPG_SL_SUBLEDGERCODE,
UPG_PL_SUBLEDGERCODE,
UPG_NL_SUBLEDGERCODE,
UPG_DISABLE_EMAIL,
UPG_DELIVER_ALLOC_STOCK,
UPG_CC_WRITE_OFF_LIMIT,
UPG_CHASE_DEBT_OWN_CUST,
UPG_RESTRICT_SORT_KEY_USE,
DefaultPOPStatus,
UPG_POP_STATUS_LEVEL,
[SL] as AccessToSalesLedger, 
[PL] as AccessToPurchaseLedger, 
[NL] as AccessToNominalLedger, 
[CB] as AccessToCashBook, 
[CF] as AccessToCreditControl, 
[CM] as AccessToCRM, 
[CST] as AccessToCosting, 
[ENQ] as AccessToEnquiries,
[IR] as AccessToInvoiceRegister, 
[POP] as AccessToPOP, 
[SOP] as AccessToSOP, 
[STK] as AccessToStock, 
[SYS] as AccessToSystem,
[WO] as AccessToWorksOrders
from
(
select USER_ID, 
      USER_NAME, 
      DATE_IN, 
      TIME_IN, 
      TIME_OUT, 
      UP_CODE, 
      UP_MODULE, 
      UP_MODULE_ON,
      USER_MASTER,
      USER_LANGUAGE,
      USER_DOMAIN,
      USER_DMS_USERNAME,
      USER_DMS_USERID,
      USER_WFF_ADMINISTRATOR,
      USER_LOCKED,
      UPG_LOGON_TIME_BEGIN,
       UPG_LOGON_TIME_END,
       TXT_USER_TEXT as DefaultSOPStatus,
       UPG_SOP_STATUS_LEVEL,
       UPG_BATCH_ONLY,
       UPG_NO_REPORTS,
       UPG_SL_FUTURE_POST,
       UPG_SL_C_YEAR_ONLY,
       UPG_PL_FUTURE_POST,
       UPG_PL_C_YEAR_ONLY,
       UPG_NL_FUTURE_POST,
       UPG_NL_C_YEAR_ONLY,
       UPG_STK_FUTURE_POST,
       UPG_STK_C_YEAR_ONLY,
       UPG_SOP_FUTURE_POST,
       UPG_SOP_C_YEAR_ONLY,
       UPG_POP_FUTURE_POST,
       UPG_POP_C_YEAR_ONLY,
       UPG_CST_FUTURE_POST,
       UPG_CST_C_YEAR_ONLY,
       UPG_AUTHORISE_OWN,
       UPG_AUTHORISE_ORDERS,
       UPG_ORDER_BUDGET,
       UPG_CURRENT_BUDGET,
       UPG_PREVIOUS_BUDGET,
       UPG_BUDGET_GROUP,
       UPG_REVISE_USER_BUDGETS,
       UPG_AUTHORISE_ALL,
       UPG_CHECK_BUDGET_VALUES,
       UPG_AUTHORISE_TYPE,
       UPG_SL_SUBLEDGERCODE,
       UPG_PL_SUBLEDGERCODE,
       UPG_NL_SUBLEDGERCODE,
       UPG_DISABLE_EMAIL,
       UPG_DELIVER_ALLOC_STOCK,
       UPG_CC_WRITE_OFF_LIMIT,
       UPG_CHASE_DEBT_OWN_CUST,
       UPG_RESTRICT_SORT_KEY_USE,
       POS_DESCRIPTION as DefaultPOPStatus,
       UPG_POP_STATUS_LEVEL
from SYS_USER 
join SYS_USER_PROFILE on UP_CODE = USER_PROFILE_CODE
join SYS_USER_PROFILE_GLOBAL on UPG_CODE = USER_PROFILE_CODE
left join POP_ORDER_STATUS on POS_PRIMARY = UPG_POP_STATUS_DEFAULT_LINK
left join SYS_LOOKUP_TEXT on TXT_ORIGIN='SOP' and TXT_PRIMARY=UPG_SOP_STATUS_DEF
) SourceTable
pivot
(
max(UP_MODULE_ON)
for UP_MODULE in ([SL],[PL],[NL],[CB],[CF],[CM],[CST],[ENQ],[IR],[POP],[SOP],[STK],[SYS],[WO])
) as PivotTable